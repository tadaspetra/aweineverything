---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

const essays = await getCollection("essays", ({ data }) => !data.draft);

const sortedEssays = essays
  .sort((a, b) => b.data.pubDatetime.valueOf() - a.data.pubDatetime.valueOf())
  .map((essay) => {
    // Handle both folder-based (how-computers-work/index.mdx) and flat (my-essay.mdx) structures
    const parts = essay.id.split("/");
    const slug = parts.length > 1 
      ? parts[0]  // Folder-based: use folder name as slug
      : parts[0].replace(/\.mdx?$/, ""); // Flat file: remove extension
    return {
      title: essay.data.title,
      slug,
    };
  });
---

<Layout>
  <main class="max-w-2xl mx-auto px-4 sm:px-6 py-12 sm:py-16 md:py-24">
    <div class="space-y-5 sm:space-y-6 text-base sm:text-lg leading-relaxed">
      <!-- 
      Add ", and looking for it on all live-streaming platforms." at the end of the second sentence.

      But do this only after I am ready for that step.
      -->

      <p class="text-neutral-500 dark:text-neutral-400">
        The world is far more astonishing than it looks.
      </p>

      <p class="text-neutral-500 dark:text-neutral-400">
        Most things we use every day—electricity, color, time, computers—feel
        ordinary only because we stopped looking closely.
      </p>

      <p class="text-neutral-500 dark:text-neutral-400">
        This is a place for deep, carefully crafted explanations of how things
        actually work. A place for clear, patient thinking that reveals the
        hidden <b
          class="font-la-belle-aurore text-neutral-600 dark:text-neutral-300 text-2xl pl-1 font-medium"
        >
          awe in everything</b
        >.
      </p>

      <p class="text-neutral-500 dark:text-neutral-400">
        The goal is to help you see the world a little more clearly than you did
        before. Because when you truly understand something, you do not just
        know it. You feel it.
      </p>

      <p class="text-neutral-500 dark:text-neutral-400">
        And that feeling is <b
          class="font-la-belle-aurore text-neutral-600 dark:text-neutral-300 text-2xl pl-1 font-medium"
          >awe</b
        >.
      </p>

      <h2 class="mt-16">latest essays</h2>
      <div class="space-y-0">
        {
          sortedEssays.length === 0 ? (
            <p class="text-neutral-500 dark:text-neutral-400">nothing yet</p>
          ) : (
            sortedEssays.map((essay) => (
              <a
                href={`/${essay.slug}`}
                class="plain-link block px-4 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors text-sm sm:text-base"
              >
                {essay.title}
              </a>
            ))
          )
        }
      </div>
    </div>
  </main>
</Layout>
